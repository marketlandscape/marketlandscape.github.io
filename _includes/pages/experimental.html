<!-- experimental.html (FULL FILE, PAGE-LOCAL GRID ONLY) -->

<style>
  /* =====================================================
     experimental-only layout (inside this file only)
     Layout:
       Row 1: box1 (left) + chart (right)
       Row 2: box2 (left) + box3 (right)
       Row 3: box4 (left) + box5 (right)
     Mobile: natural DOM order
     ===================================================== */

  .v2 .indexes{
    display: grid;
    grid-template-columns: repeat(2, 360px);
    column-gap: 28px;
    row-gap: 28px;
    align-items: start;
  }

  .v2 .indexes > div{
    margin-bottom: 0 !important;
  }

  @media (max-width: 780px){
    .v2 .indexes{
      grid-template-columns: 360px;
    }
  }
</style>

<div class="v2">

  <div class="indexes">

    <!-- BOX 1 -->
    <div>
      <div class="entity-box" data-box="1">

        <div class="entity-title">{% include t.html key="index.box1.title" %}</div>

        <picture style="position:absolute; inset:0; width:360px; height:150px; z-index:1; pointer-events:none;">
          <source media="(prefers-color-scheme: dark)" srcset="/assets/img/bar-orange-dark.svg">
          <img src="/assets/img/bar-orange-light.svg" alt=""
               style="position:absolute; left:19.1px; top:116.7px; width:322.6px; height:9px;">
        </picture>

        <svg class="entity-frame" viewBox="0 0 360 150">
          <rect class="entity-frame-bg" width="360" height="150" rx="14"></rect>
          <rect class="entity-frame-stroke" x="0.5" y="0.5" width="359" height="149" rx="13.5"></rect>
        </svg>

        <div class="entity-steps">
          <span>{% include t.html key="index.step.entry" %}</span>
          <span>{% include t.html key="index.step.scale_in" %}</span>
          <span>{% include t.html key="index.step.hold" %}</span>
          <span>{% include t.html key="index.step.conviction" %}</span>
          <span>{% include t.html key="index.step.hodl" %}</span>
        </div>

        <div class="entity-value" data-role="val">–</div>

        <div class="entity-risk">
          <span class="entity-warn" data-role="warn">⚠</span>
          <span class="entity-risk-label">{% include t.html key="index.risk.label" %}</span>
          <span class="entity-risk-val" data-role="risk">–%</span>
        </div>

        <svg class="entity-dot-layer" viewBox="0 0 360 150">
          <circle class="entity-dot-outer" cx="29.76" cy="121.2" r="9"></circle>
          <circle class="entity-dot-inner" cx="29.76" cy="121.2" r="6"></circle>
        </svg>

      </div>
    </div>

    <!-- CHART (top-right, inline-only) -->
    <div>
      <div style="width:360px;height:150px;position:relative;">
        <div id="navChart"
             style="position:absolute;inset:0;padding:8px 10px 8px 10px;z-index:2;"></div>

        <svg class="entity-frame"
             viewBox="0 0 360 150"
             style="position:absolute;inset:0;z-index:1;pointer-events:none;">
          <rect class="entity-frame-bg" width="360" height="150" rx="14"></rect>
          <rect class="entity-frame-stroke" x="0.5" y="0.5" width="359" height="149" rx="13.5"></rect>
        </svg>
      </div>
    </div>

    <!-- BOX 2 -->
    <div>
      <div class="entity-box" data-box="2">
        <div class="entity-title">{% include t.html key="index.box2.title" %}</div>
        <picture style="position:absolute; inset:0; width:360px; height:150px; z-index:1; pointer-events:none;">
          <source media="(prefers-color-scheme: dark)" srcset="/assets/img/bar-blue-dark.svg">
          <img src="/assets/img/bar-blue-light.svg" alt=""
               style="position:absolute; left:19.1px; top:116.7px; width:322.6px; height:9px;">
        </picture>
        <svg class="entity-frame" viewBox="0 0 360 150">
          <rect class="entity-frame-bg" width="360" height="150" rx="14"></rect>
          <rect class="entity-frame-stroke" x="0.5" y="0.5" width="359" height="149" rx="13.5"></rect>
        </svg>
        <div class="entity-steps">
          <span>{% include t.html key="index.step.entry" %}</span>
          <span>{% include t.html key="index.step.scale_in" %}</span>
          <span>{% include t.html key="index.step.hold" %}</span>
          <span>{% include t.html key="index.step.reduce" %}</span>
          <span>{% include t.html key="index.step.exit" %}</span>
        </div>
        <div class="entity-value" data-role="val">–</div>
        <div class="entity-risk">
          <span class="entity-warn" data-role="warn">⚠</span>
          <span class="entity-risk-label">{% include t.html key="index.risk.label" %}</span>
          <span class="entity-risk-val" data-role="risk">–%</span>
        </div>
        <svg class="entity-dot-layer" viewBox="0 0 360 150">
          <circle class="entity-dot-outer" cx="29.76" cy="121.2" r="9"></circle>
          <circle class="entity-dot-inner" cx="29.76" cy="121.2" r="6"></circle>
        </svg>
      </div>
    </div>

    <!-- BOX 3 -->
    <div>
      <div class="entity-box" data-box="3">
        <div class="entity-title">
          {% include t.html key="experimental.box3.title" default="Altcoin Navigation Index" %}
        </div>
        <picture style="position:absolute; inset:0; width:360px; height:150px; z-index:1; pointer-events:none;">
          <source media="(prefers-color-scheme: dark)" srcset="/assets/img/bar-updated-grey.svg">
          <img src="/assets/img/bar-grey-light.svg" alt=""
               style="position:absolute; left:19.1px; top:116.7px; width:322.6px; height:9px;">
        </picture>
        <svg class="entity-frame" viewBox="0 0 360 150">
          <rect class="entity-frame-bg" width="360" height="150" rx="14"></rect>
          <rect class="entity-frame-stroke" x="0.5" y="0.5" width="359" height="149" rx="13.5"></rect>
        </svg>
        <div class="entity-steps">
          <span>{% include t.html key="index.step.entry" %}</span>
          <span>{% include t.html key="index.step.scale_in" %}</span>
          <span>{% include t.html key="index.step.hold" %}</span>
          <span>{% include t.html key="index.step.reduce" %}</span>
          <span>{% include t.html key="index.step.exit" %}</span>
        </div>
        <div class="entity-value" data-role="val">–</div>
        <div class="entity-risk">
          <span class="entity-warn" data-role="warn">⚠</span>
          <span class="entity-risk-label">{% include t.html key="index.risk.label" %}</span>
          <span class="entity-risk-val" data-role="risk">–%</span>
        </div>
        <svg class="entity-dot-layer" viewBox="0 0 360 150">
          <circle class="entity-dot-outer" cx="29.76" cy="121.2" r="9"></circle>
          <circle class="entity-dot-inner" cx="29.76" cy="121.2" r="6"></circle>
        </svg>
      </div>
    </div>

  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<script>
(function(){
  function clamp(v,l,h){return Math.max(l,Math.min(h,v));}
  function pctToStep(x){
    const n=Number(x); if(!Number.isFinite(n)) return null;
    return Math.round((clamp(n,0,100)/100)*24)+1;
  }
  function fmtX(s){
    const m=String(s).match(/^(\d{4})-(\d{2})-(\d{2})/);
    return m ? (m[2]+"-"+m[3]) : "";
  }

  async function init(){
    const el=document.getElementById("navChart");
    if(!el||!window.echarts) return;

    const r=await fetch("/data/charts/nav_2w.json",{cache:"no-store"});
    if(!r.ok) return;
    const rows=await r.json();

    const times=rows.map(x=>x.t);
    const s1=rows.map(x=>pctToStep(x.box1));
    const s2=rows.map(x=>pctToStep(x.box2));
    const s3=rows.map(x=>pctToStep(x.box3));

    const c=echarts.init(el);
    c.setOption({
      backgroundColor:"transparent",
      grid:{left:6,right:6,top:8,bottom:8},
      xAxis:{
        type:"category",data:times,boundaryGap:false,
        axisLine:{show:false},axisTick:{show:false},
        axisLabel:{
          fontSize:10,color:"rgba(255,255,255,0.4)",
          interval:(i)=> i%Math.ceil(times.length/4)!==0,
          formatter:fmtX
        }
      },
      yAxis:{type:"value",min:1,max:25,axisLabel:{show:false},
             axisLine:{show:false},axisTick:{show:false}},
      series:[
        {type:"line",data:s1,smooth:true,showSymbol:false,
         lineStyle:{width:2,color:"rgba(216,165,56,0.95)"},
         markArea:{silent:true,itemStyle:{color:"rgba(255,255,255,0.035)"},
           data:[[{yAxis:1},{yAxis:5}],[{yAxis:5},{yAxis:10}],
                 [{yAxis:10},{yAxis:15}],[{yAxis:15},{yAxis:20}],
                 [{yAxis:20},{yAxis:25}]]}},
        {type:"line",data:s2,smooth:true,showSymbol:false,
         lineStyle:{width:2,color:"rgba(74,141,255,0.95)"}},
        {type:"line",data:s3,smooth:true,showSymbol:false,
         lineStyle:{width:2,color:"rgba(190,190,190,0.6)"}}
      ]
    });

    window.addEventListener("resize",()=>c.resize(),{passive:true});
  }

  document.readyState==="loading"
    ? document.addEventListener("DOMContentLoaded",init)
    : init();
})();
</script>
